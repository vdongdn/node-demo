<h2>ƒê·ªãa ƒëi·ªÉm c·ªßa t√¥i</h2>
<div class="mt-4 d-flex align-items-center">
  <div class="form-check">
    <input class="form-check-input" type="checkbox" id="placeCheckAll">
    <label class="form-check-label" for="placeCheckAll">
      Ch·ªçn t·∫•t c·∫£
    </label>
  </div>
  <select class="form-select form-select-sm place-select-action" id="selectAction" aria-label="Ch·ªçn h√†nh ƒë·ªông">
    <option value="">-- H√†nh ƒë·ªông --</option>
    <option value="delete">X√≥a</option>
  </select>
  <button class="btn btn-sm btn-primary" id="btnAction" disabled>Th·ª±c hi·ªán</button>
</div>
<table class="table mt-4">
  <thead>
    <tr>
      <th scope="col" colspan="2" >#</th>
      <th scope="col">·∫¢nh ƒë·∫°i di·ªán</th>
      <th scope="col">
        T√™n ƒë·ªãa ƒëi·ªÉm
        {{{sortable 'name' _sort}}}
      </th>
      <th scope="col">
        Ng√†y t·∫°o
        {{{sortable 'createdAt' _sort}}}
        </th>
      <th scope="col">Thao t√°c</th>
    </tr>
  </thead>
  <tbody>
    {{#each place}}
    <tr>
      <td>
        <input class="form-check-input" type="checkbox" value="{{this._id}}" name="chk-places[]">
      </td>
      <td scope="row">{{sum @index 1}}</td>
      <td>
        <img class="table-img" src="{{this.image}}" alt="">
      </td>
      <td>{{this.name}}</td>
      <td>{{this.createdAt}}</td>
      <td>
        <a class="btn btn-link" href="/place/{{this._id}}/edit">S·ª≠a</a>
        <a class="btn btn-link" href="" data-bs-toggle="modal" data-bs-target="#delPlaceModal" data-id="{{this._id}}">X√≥a</a>
      </td>
    </tr>
    {{/each}}
  </tbody>
</table>
<div class="modal fade" id="delPlaceModal" tabindex="-1" aria-labelledby="placeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="placeModalLabel">X√°c nh·∫≠n x√≥a</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë·ªãa ƒëi·ªÉm n√†y kh√¥ng?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
        <button type="button" class="btn btn-danger" id="btnDelPlace">X√°c nh·∫≠n</button>
      </div>
    </div>
  </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var placeId;
        var btnDel = document.getElementById('btnDelPlace');
        var chkCheckAll = $('#placeCheckAll');
        var chkCheckOne = $('input[name="chk-places[]"]');
        var selectAction = $('#selectAction');

        $('#delPlaceModal').on('show.bs.modal', event => {
            const button = event.relatedTarget;
            placeId = button.getAttribute('data-id');
        })

        $('#btnDelPlace').on('click', () => {
              $.post("/place/del", {_id: placeId}, function(result){
                if(result.ok) {
                  location.reload();
                } else {
                  alert(result.msg);
                }
              });
        })

        chkCheckAll.change(function() {
          var isChecked =  $('#placeCheckAll').prop('checked');
          chkCheckOne.prop('checked', isChecked );
        })       
        
        chkCheckOne.change(function() {
          var isCheckedAll =  chkCheckOne.length === $('input[name="chk-places[]"]:checked').length;
          console.log("üöÄ ~ isCheckedAll", isCheckedAll)
          chkCheckAll.prop('checked', isCheckedAll);
        })

        selectAction.change(function() {
          var option =  selectAction.val();
          if (option) {
            $('#btnAction').prop('disabled', false );
          } else {
            $('#btnAction').prop('disabled', true );
          }
        })  
    })
</script>